# ë¼ì´ë¸ŒëŸ¬ë¦¬ì»´í¼ë‹ˆ ê³µì—° ë°ì´í„° ë¶„ì„ ì„œë²„

## í”„ë¡œì íŠ¸ ê°œìš”

ë¼ì´ë¸ŒëŸ¬ë¦¬ì»´í¼ë‹ˆì˜ ê³µì—° ì˜ˆìˆ  ì—…ê³„(ì½˜ì„œíŠ¸, ì—°ê·¹/ë®¤ì§€ì»¬) ë°ì´í„°ë¥¼ ì¢…í•©ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê³  ë¶„ì„í•˜ëŠ” ë°±ì—”ë“œ ì„œë²„ì…ë‹ˆë‹¤.

### ì£¼ìš” ëª©ì 
- ê³µì—° ë§¤ì¶œ ë°ì´í„° ìˆ˜ì§‘ ë° ë¶„ì„
- ì¢Œì„ íŒë§¤ í˜„í™© ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
- ë§ˆì¼€íŒ… ìº˜ë¦°ë” ë° ê³µì—° ì¼ì • ê´€ë¦¬
- ëª©í‘œ ë§¤ì¶œ ëŒ€ë¹„ ì‹¤ì  ë¶„ì„
- ë‹¤ì–‘í•œ ë¦¬í¬íŠ¸ ë° ëŒ€ì‹œë³´ë“œ ì œê³µ

### ì„œë²„ ì •ë³´
- **ê°œë°œ ì„œë²„**: `http://localhost:3001`
- **í”„ë¡œë•ì…˜ ì„œë²„**: `http://35.208.29.100:3001`
- **Swagger ë¬¸ì„œ**: `http://35.208.29.100:3001/api`
- **ìš´ì˜ í˜„í™©**: 24ì¼ê°„ ë¬´ì¤‘ë‹¨ ìš´ì˜ (ì•ˆì •ì„± ê²€ì¦ë¨)

## ê¸°ìˆ  ìŠ¤íƒ

### Backend Framework
- **NestJS** - TypeScript ê¸°ë°˜ Node.js í”„ë ˆì„ì›Œí¬
- **TypeORM** - TypeScript ORM
- **PostgreSQL** - ë©”ì¸ ë°ì´í„°ë² ì´ìŠ¤
- **Swagger** - API ë¬¸ì„œí™”

### Infrastructure & Deployment
- **Google Cloud Platform (GCP)** - í´ë¼ìš°ë“œ í˜¸ìŠ¤íŒ…
- **Docker** - ì»¨í…Œì´ë„ˆí™” (PostgreSQL)
- **PM2** - í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬ ë° í´ëŸ¬ìŠ¤í„°ë§
- **Docker Compose** - ë¡œì»¬ ê°œë°œí™˜ê²½

### Additional Libraries
- **AdminJS** - ê´€ë¦¬ì íŒ¨ë„
- **Puppeteer & Selenium** - ì›¹ ìŠ¤í¬ë˜í•‘
- **OpenAI API** - AI ê¸°ëŠ¥ ì—°ë™
- **Slack API** - ì•Œë¦¼ ì—°ë™
- **Schedule** - ìŠ¤ì¼€ì¤„ë§ ì‘ì—…
- **Axios** - HTTP í´ë¼ì´ì–¸íŠ¸
- **Multer** - íŒŒì¼ ì—…ë¡œë“œ

## ì£¼ìš” ê¸°ëŠ¥

### ë°ì´í„° ê´€ë¦¬
- **ê³µì—° ê´€ë¦¬**: ì½˜ì„œíŠ¸, ì—°ê·¹/ë®¤ì§€ì»¬ ì •ë³´ ê´€ë¦¬
- **ë§¤ì¶œ ë°ì´í„°**: í‹°ì¼“ íŒë§¤ëŸ‰, ì¢Œì„ë³„ íŒë§¤ í˜„í™©
- **íŒŒì¼ ì—…ë¡œë“œ**: ì—‘ì…€/CSV ë°ì´í„° ì—…ë¡œë“œ ë° ì²˜ë¦¬ (85ê°œ+ íŒŒì¼ ê´€ë¦¬)
- **ì‚¬ìš©ì ê´€ë¦¬**: ì ‘ê·¼ ê¶Œí•œ ë° ì‚¬ìš©ì ê³„ì • ê´€ë¦¬

### ë¶„ì„ ë° ë¦¬í¬íŒ…
- **ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ**: ë§¤ì¶œ í˜„í™© ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
- **ëª©í‘œ ëŒ€ë¹„ ì‹¤ì **: ì¼ë³„/ì£¼ë³„/ì›”ë³„ ëª©í‘œ ëŒ€ë¹„ ë¶„ì„
- **ìˆ˜ìµì„± ë¶„ì„**: BEP(ì†ìµë¶„ê¸°ì ) ë¶„ì„
- **ë§ˆì¼€íŒ… ë¶„ì„**: ë§ˆì¼€íŒ… í™œë™ ëŒ€ë¹„ ë§¤ì¶œ íš¨ê³¼ ë¶„ì„

### ìë™í™” ê¸°ëŠ¥
- **ìŠ¤ì¼€ì¤„ë§**: ì •ê¸°ì ì¸ ë°ì´í„° ìˆ˜ì§‘ ë° ë¦¬í¬íŠ¸ ìƒì„±
- **ì•Œë¦¼ ì‹œìŠ¤í…œ**: Slackì„ í†µí•œ ì‹¤ì‹œê°„ ì•Œë¦¼
- **ë°ì´í„° ë™ê¸°í™”**: ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ì˜ ë°ì´í„° ì—°ë™

## ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°ë„

```mermaid
graph TB
    subgraph "Frontend Layer"
        A1["Vercel Frontend<br/>https://librarycompany-data-analysis.vercel.app"]
        A2["ê´€ë¦¬ì ì›¹ ì½˜ì†”<br/>AdminJS"]
        A3["API ë¬¸ì„œ<br/>Swagger UI<br/>/api"]
    end
    
    subgraph "API Gateway Layer"
        B["NestJS Application<br/>Port: 3001<br/>CORS ì„¤ì •<br/>Swagger í†µí•©"]
    end
    
    subgraph "Application Layer"
        subgraph "Core Modules"
            C1["AppModule<br/>ë©”ì¸ ëª¨ë“ˆ<br/>ì „ì—­ ì„¤ì •"]
            C2["UploadModule<br/>íŒŒì¼ ì—…ë¡œë“œ<br/>ì—‘ì…€ íŒŒì‹±"]
            C3["UsersModule<br/>ì‚¬ìš©ì ê´€ë¦¬<br/>ê¶Œí•œ ì œì–´"]
            C4["LiveModule<br/>ê³µì—° ê´€ë¦¬<br/>ê³µì—° ì •ë³´"]
        end
        
        subgraph "Business Modules"
            D1["ConcertModule<br/>ì½˜ì„œíŠ¸ ë¶„ì„<br/>ë§¤ì¶œ/BEP ë¶„ì„"]
            D2["PlayModule<br/>ì—°ê·¹/ë®¤ì§€ì»¬<br/>ê³µì—° ë°ì´í„°"]
            D3["ReportModule<br/>ë¦¬í¬íŠ¸ ìƒì„±<br/>AI ë¶„ì„ ì—°ë™"]
            D4["TargetModule<br/>ëª©í‘œ ê´€ë¦¬<br/>ì‹¤ì  ë¹„êµ"]
        end
        
        subgraph "Support Modules"
            E1["SlackModule<br/>ì•Œë¦¼ ì„œë¹„ìŠ¤<br/>Webhook ì—°ë™"]
            E2["CalendarModule<br/>ì¼ì • ê´€ë¦¬<br/>ë§ˆì¼€íŒ… ìº˜ë¦°ë”"]
            E3["MarketingModule<br/>ë§ˆì¼€íŒ… ë¶„ì„<br/>í”„ë¡œëª¨ì…˜ ê´€ë¦¬"]
            E4["ViewModule<br/>ë°ì´í„° ë·°<br/>ì¡°íšŒ ìµœì í™”"]
            E5["LocalScheduleModule<br/>ìŠ¤ì¼€ì¤„ëŸ¬<br/>ì •ê¸° ì‘ì—…"]
        end
    end
    
    subgraph "Data Layer"
        F["PostgreSQL Database<br/>Port: 1377<br/>Container: libraryPostgres"]
        
        subgraph "Database Views (30+)"
            G1["Concert Views<br/>view_con_*<br/>ì½˜ì„œíŠ¸ ë¶„ì„ ë·°"]
            G2["Play Views<br/>view_llm_play_*<br/>ì—°ê·¹ ë¶„ì„ ë·°"]
            G3["Marketing Views<br/>ë§ˆì¼€íŒ… ë¶„ì„ ë·°"]
        end
        
        subgraph "Core Tables"
            H1["LiveModel<br/>ê³µì—° ì •ë³´"]
            H2["FileUploadModel<br/>íŒŒì¼ ì—…ë¡œë“œ"]
            H3["UserModel<br/>ì‚¬ìš©ì ì •ë³´"]
            H4["Sales Tables<br/>ë§¤ì¶œ ë°ì´í„°"]
        end
    end
    
    subgraph "External Services"
        I1["OpenAI API<br/>GPT Integration<br/>AI ë¶„ì„"]
        I2["Slack API<br/>Webhook ì•Œë¦¼<br/>ì‹¤ì‹œê°„ notification"]
    end
    
    subgraph "Infrastructure"
        J1["PM2 Process Manager<br/>í´ëŸ¬ìŠ¤í„° ëª¨ë“œ<br/>ë¬´ì¤‘ë‹¨ ìš´ì˜"]
        J2["Docker Container<br/>PostgreSQL ì»¨í…Œì´ë„ˆ<br/>ì˜ì† ë³¼ë¥¨"]
        J3["File System<br/>uploads/ ë””ë ‰í† ë¦¬<br/>85+ ì—‘ì…€ íŒŒì¼"]
    end
    
    %% Frontend to API
    A1 --> B
    A2 --> B
    A3 --> B
    
    %% API to Core Modules
    B --> C1
    C1 --> C2
    C1 --> C3
    C1 --> C4
    
    %% Core to Business Modules
    C1 --> D1
    C1 --> D2
    C1 --> D3
    C1 --> D4
    
    %% Core to Support Modules
    C1 --> E1
    C1 --> E2
    C1 --> E3
    C1 --> E4
    C1 --> E5
    
    %% Database Connections
    C2 --> F
    C3 --> F
    C4 --> F
    D1 --> F
    D2 --> F
    D3 --> F
    D4 --> F
    E2 --> F
    E3 --> F
    
    %% Database Internal Structure
    F --> G1
    F --> G2
    F --> G3
    F --> H1
    F --> H2
    F --> H3
    F --> H4
    
    %% External Service Connections
    D3 --> I1
    E1 --> I2
    
    %% Infrastructure
    B --> J1
    F --> J2
    C2 --> J3
    
    %% Styling
    classDef frontend fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef api fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef core fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef business fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef support fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef database fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    classDef external fill:#fff8e1,stroke:#ffa000,stroke-width:2px
    classDef infra fill:#f1f8e9,stroke:#558b2f,stroke-width:2px
    
    class A1,A2,A3 frontend
    class B api
    class C1,C2,C3,C4 core
    class D1,D2,D3,D4 business
    class E1,E2,E3,E4,E5 support
    class F,G1,G2,G3,H1,H2,H3,H4 database
    class I1,I2 external
    class J1,J2,J3 infra
```

### ì¸í”„ë¼ êµ¬ì¡°ë„

```mermaid
graph TB
    subgraph "Internet"
        U["ì‚¬ìš©ì<br/>ë¸Œë¼ìš°ì €/API í´ë¼ì´ì–¸íŠ¸"]
        DEV["ê°œë°œì<br/>SSH ì ‘ì†"]
        VERCEL["Vercel Frontend<br/>https://librarycompany-data-analysis.vercel.app"]
    end
    
    subgraph "GCP Project (us-central1-a)"
        subgraph "Network Security"
            FW1["ë°©í™”ë²½ ê·œì¹™<br/>SSH (22)"]
            FW2["ë°©í™”ë²½ ê·œì¹™<br/>API (3001)"]
            FW3["ë‚´ë¶€ ì ‘ê·¼<br/>PostgreSQL (1377)"]
        end
        
        subgraph "VM Instance (e2-micro)"
            VM["instance-20250211-224503<br/>External: 35.208.29.100<br/>Internal: 10.128.0.2<br/>Ubuntu 22.04.5 LTS<br/>1GB RAM, 1 vCPU"]
            
            subgraph "Runtime Environment"
                NODE["Node.js v20.18.3<br/>npm v10.8.2"]
                DOCKER["Docker v27.5.1<br/>Docker Compose v2.32.4"]
                PM2_ENV["PM2 v5.4.3<br/>í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬ì"]
            end
            
            subgraph "Application Stack"
                PM2["PM2 í´ëŸ¬ìŠ¤í„°<br/>24ì¼ ì—°ì† ìš´ì˜<br/>ìë™ ì¬ì‹œì‘"]
                NESTJS["NestJS API<br/>Port: 3001<br/>Memory: 111.4MB<br/>Heap: 85.84%"]
                SWAGGER["Swagger UI<br/>/api<br/>API ë¬¸ì„œí™”"]
            end
            
            subgraph "Database Container"
                POSTGRES_DOCKER["Docker Container<br/>libraryPostgres<br/>postgres:15"]
                POSTGRES_DB["PostgreSQL DB<br/>User: libraryPostgres<br/>DB: libraryPostgres<br/>Port: 1377:5432"]
            end
            
            subgraph "File System"
                UPLOADS["uploads/<br/>85+ Excel files<br/>~80MB storage"]
                POSTGRES_DATA["postgres-data/<br/>ì˜ì† ë³¼ë¥¨<br/>DB ë°ì´í„°"]
                LOGS["PM2 Logs<br/>ìë™ ë¡œí…Œì´ì…˜<br/>10MB max"]
            end
        end
    end
    
    subgraph "External APIs"
        SLACK_API["Slack API<br/>Webhook ì•Œë¦¼<br/>ì‹¤ì‹œê°„ notification"]
        OPENAI_API["OpenAI API<br/>GPT Integration<br/>AI ë¶„ì„ ê¸°ëŠ¥"]
    end
    
    %% Network Flow
    U -->|HTTPS/HTTP| VERCEL
    VERCEL -->|API Calls| FW2
    U -->|Direct API| FW2
    FW2 --> VM
    
    DEV -->|SSH| FW1
    FW1 --> VM
    
    %% Internal Architecture
    VM --> NODE
    VM --> DOCKER
    VM --> PM2_ENV
    
    NODE --> PM2
    PM2 --> NESTJS
    NESTJS --> SWAGGER
    
    DOCKER --> POSTGRES_DOCKER
    POSTGRES_DOCKER --> POSTGRES_DB
    
    %% Database Access
    NESTJS -->|Local Connection| FW3
    FW3 --> POSTGRES_DOCKER
    
    %% File System Access
    NESTJS --> UPLOADS
    POSTGRES_DOCKER --> POSTGRES_DATA
    PM2 --> LOGS
    
    %% External Service Integration
    NESTJS --> SLACK_API
    NESTJS --> OPENAI_API
    
    %% Styling
    classDef internet fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef gcp fill:#4285f4,stroke:#fff,stroke-width:2px,color:#fff
    classDef security fill:#ff6b35,stroke:#fff,stroke-width:2px,color:#fff
    classDef vm fill:#34a853,stroke:#fff,stroke-width:2px,color:#fff
    classDef app fill:#ea4335,stroke:#fff,stroke-width:2px,color:#fff
    classDef database fill:#0f9d58,stroke:#fff,stroke-width:2px,color:#fff
    classDef external fill:#fbbc04,stroke:#333,stroke-width:2px
    
    class U,DEV,VERCEL internet
    class FW1,FW2,FW3 security
    class VM,NODE,DOCKER,PM2_ENV vm
    class PM2,NESTJS,SWAGGER app
    class POSTGRES_DOCKER,POSTGRES_DB database
    class UPLOADS,POSTGRES_DATA,LOGS database
    class SLACK_API,OPENAI_API external
```

### ë°ì´í„° íŒŒì´í”„ë¼ì¸

```mermaid
graph TD
    subgraph "Data Input Layer"
        A1["Excel íŒŒì¼ ì—…ë¡œë“œ<br/>POST /upload/play-excel"]
        A2["ì‚¬ìš©ì ì…ë ¥<br/>ëª©í‘œ/ë§ˆì¼€íŒ… ì„¤ì •"]
        A3["ì™¸ë¶€ ë°ì´í„°<br/>LLM"]
    end
    
    subgraph "Data Processing Layer"
        B1["íŒŒì¼ëª… íŒŒì‹±<br/>ë‚ ì§œ/ê³µì—°ID ì¶”ì¶œ"]
        B2["ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜<br/>ì½˜ì„œíŠ¸/ì—°ê·¹/ë®¤ì§€ì»¬"]
        B3["ë°ì´í„° ì •ê·œí™”<br/>íƒ€ì… ê²€ì¦"]
        B4["ì¤‘ë³µ ë°ì´í„° ì²˜ë¦¬<br/>ìµœì‹  ë°ì´í„° ìœ ì§€"]
    end
    
    subgraph "Data Storage Layer"
        C1["Core Tables<br/>LiveModel (ê³µì—° ì •ë³´)<br/>FileUploadModel (ë©”íƒ€ë°ì´í„°)<br/>UserModel (ì‚¬ìš©ì)"]
        C2["Concert Data<br/>ConcertTicketSaleModel<br/>ConcertSeatSaleModel"]
        C3["Play Data<br/>PlayTicketSaleModel<br/>PlayShowSaleModel"]
        C4["Management Data<br/>DailyTargetModel<br/>WeeklyMarketingCalendarModel<br/>CalendarModel"]
    end
    
    subgraph "Data Analysis Layer"
        D1["Real-time Views (30+)<br/>view_con_* (ì½˜ì„œíŠ¸ ë¶„ì„)<br/>view_llm_play_* (ì—°ê·¹ ë¶„ì„)<br/>ìë™ ì§‘ê³„ ë° ê³„ì‚°"]
        D2["Business Logic<br/>BEP ë¶„ì„<br/>ìˆ˜ìµì„± ê³„ì‚°<br/>ì ìœ ìœ¨ ë¶„ì„"]
        D3["AI Processing<br/>OpenAI ì—°ë™<br/>ì˜ˆì¸¡ ë¶„ì„<br/>ì¸ì‚¬ì´íŠ¸ ìƒì„±"]
    end
    
    subgraph "Data Output Layer"
        E1["REST API<br/>30+ ì—”ë“œí¬ì¸íŠ¸<br/>JSON ì‘ë‹µ<br/>Swagger ë¬¸ì„œí™”"]
        E2["Real-time Dashboard<br/>Frontend ì—°ë™<br/>ì°¨íŠ¸/í…Œì´ë¸” ë°ì´í„°<br/>ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸"]
        E3["Notification System<br/>Slack Webhook<br/>ì¼ì¼/ì£¼ê°„ ë¦¬í¬íŠ¸<br/>ì•Œë¦¼ ì „ì†¡"]
        E4["File Downloads<br/>Excel ë‹¤ìš´ë¡œë“œ<br/>ì›ë³¸ íŒŒì¼ ì œê³µ<br/>ë°±ì—… ê¸°ëŠ¥"]
    end
    
    %% Data Flow
    A1 --> B1
    A2 --> B3
    A3 --> D3
    
    B1 --> B2
    B2 --> B3
    B3 --> B4
    
    B4 --> C1
    B2 -->|ì½˜ì„œíŠ¸| C2
    B2 -->|ì—°ê·¹/ë®¤ì§€ì»¬| C3
    A2 --> C4
    
    C1 --> D1
    C2 --> D1
    C3 --> D1
    C4 --> D1
    
    D1 --> D2
    D2 --> D3
    
    D1 --> E1
    D2 --> E1
    D3 --> E1
    
    E1 --> E2
    E1 --> E3
    C1 --> E4
    
    %% Styling
    classDef input fill:#e8f5e8,stroke:#4caf50,stroke-width:2px
    classDef process fill:#fff3e0,stroke:#ff9800,stroke-width:2px
    classDef storage fill:#e3f2fd,stroke:#2196f3,stroke-width:2px
    classDef analysis fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px
    classDef output fill:#ffebee,stroke:#f44336,stroke-width:2px
    
    class A1,A2,A3 input
    class B1,B2,B3,B4 process
    class C1,C2,C3,C4 storage
    class D1,D2,D3 analysis
    class E1,E2,E3,E4 output
```

### ë°ì´í„°ë² ì´ìŠ¤ ERD

```mermaid
erDiagram
    UserModel {
        int id PK
        string email UK
        string password
        string name UK
        int role
        boolean isFileUploader
        boolean isLiveManager
        text[] liveNameList
        boolean status
        timestamp updatedAt
        timestamp createdAt
    }
    
    LiveModel {
        int id PK
        string liveId UK
        string category
        boolean isLive
        string liveName
        string location
        date showStartDate
        date showEndDate
        date saleStartDate
        date saleEndDate
        int runningTime
        decimal targetShare
        bigint bep
        int showTotalSeatNumber
        date previewEndingDate
        date latestRecordDate
        timestamp concertDateTime
        int concertSeatNumberR
        int concertSeatNumberS
        int concertSeatNumberA
        int concertSeatNumberB
        int concertSeatNumberVip
        timestamp createdAt
    }
    
    FileUploadModel {
        int id PK
        string fileName
        date recordDate
        string uploadBy
        boolean isSavedFile
        timestamp uploadDate
        timestamp deleteDate
    }
    
    PlayTicketSaleModel {
        int id PK
        string liveId
        date recordDate
        int salesDate
        bigint ticketSalesAmount
        int ticketSalesNo
    }
    
    PlayShowSaleModel {
        int id PK
        date recordDate
        string liveId
        timestamp showDateTime
        text[] cast
        int paidSeatSales
        int paidSeatTot
        int paidSeatVip
        int paidSeatA
        int paidSeatS
        int paidSeatR
        int paidBadSeatA
        int paidBadSeatS
        int paidBadSeatR
        int paidDisableSeat
        int inviteSeatTot
        int inviteSeatVip
        int inviteSeatA
        int inviteSeatS
        int inviteSeatR
        int inviteBadSeatA
        int inviteBadSeatS
        int inviteBadSeatR
        int inviteDisableSeat
        decimal depositShare
        decimal paidShare
        decimal freeShare
    }
    
    ConcertTicketSaleModel {
        int id PK
        string liveId
        date recordDate
        int salesDate
        bigint ticketSalesAmount
        int ticketSalesNo
    }
    
    ConcertSeatSaleModel {
        int id PK
        date recordDate
        timestamp showDateTime
        string liveId
        int paidSeatR
        int paidSeatS
        int paidSeatA
        int paidSeatB
        int paidSeatVip
        int paidSeatTot
        int inviteSeatR
        int inviteSeatS
        int inviteSeatA
        int inviteSeatB
        int inviteSeatVip
        int inviteSeatTot
        int remainSeatTot
        int totalSeatTot
        decimal totalSeatSalesRate
        decimal paidSalesRate
        decimal inviteSalesRate
        decimal remainSalesRate
    }
    
    DailyTargetModel {
        int id PK
        date date
        int target
        timestamp createdAt
    }
    
    WeeklyMarketingCalendarModel {
        int id PK
        int weekNumber
        date weekStartDate
        date weekEndDate
        text salesMarketing
        text promotion
        text etc
        timestamp createdAt
    }
    
    CalendarModel {
        int id PK
        date date
        string noteSales
        string noteMarketing
        string noteOthers
        timestamp createdAt
    }
    
    MonthlyEtcModel {
        int id PK
        int year
        int month
        text etc
        timestamp updatedAt
    }
    
    %% Database Views (Read-Only)
    ViewConAllDaily {
        string liveId
        string liveName
        date recordDate
        string recordMonth
        date recordWeek
        int dailySalesTicketNo
        bigint dailySalesAmount
    }
    
    ViewLlmPlayDaily {
        int id
        string liveId
        string liveName
        date latestRecordDate
        int showTotalSeatNumber
        bigint dailySales
        date startDate
        date endDate
        date recordDate
        timestamp showDateTime
        string cast
        int paidSeatSales
        int paidSeatTot
        decimal paidShare
    }
    
    ViewConBep {
        string liveId
        string liveName
        date latestRecordDate
        date salesStartDate
        date salesEndDate
        string seatClass
        int seatOrder
        int totalSeats
        int soldSeats
        int remainingSeats
        decimal estAdditionalSales
        decimal estFinalRemaining
        decimal bepSeats
        decimal bepRatio
        decimal estSalesRatio
    }
    
    %% Relationships
    LiveModel ||--o{ FileUploadModel : "has uploads"
    LiveModel ||--o{ DailyTargetModel : "has targets"
    LiveModel ||--o{ WeeklyMarketingCalendarModel : "has marketing"
    
    FileUploadModel ||--o{ PlayTicketSaleModel : "contains play data"
    FileUploadModel ||--o{ PlayShowSaleModel : "contains show data"
    FileUploadModel ||--o{ ConcertTicketSaleModel : "contains concert data"
    FileUploadModel ||--o{ ConcertSeatSaleModel : "contains seat data"
    
    %% View Dependencies (logical relationships)
    LiveModel ||--o{ ViewConAllDaily : "aggregates from"
    LiveModel ||--o{ ViewLlmPlayDaily : "aggregates from"
    LiveModel ||--o{ ViewConBep : "calculates from"
    
    PlayTicketSaleModel ||--o{ ViewLlmPlayDaily : "feeds into"
    PlayShowSaleModel ||--o{ ViewLlmPlayDaily : "feeds into"
    ConcertTicketSaleModel ||--o{ ViewConAllDaily : "feeds into"
    ConcertSeatSaleModel ||--o{ ViewConBep : "feeds into"
```

### ì•„í‚¤í…ì²˜ íŠ¹ì§•

#### ëª¨ë“ˆí™”ëœ ì•„í‚¤í…ì²˜
- **ë„ë©”ì¸ ë¶„ë¦¬**: Concert, Play, Upload ë“± ê° ë„ë©”ì¸ë³„ ë…ë¦½ ëª¨ë“ˆ
- **ì˜ì¡´ì„± ê´€ë¦¬**: ìˆœí™˜ ì°¸ì¡° ë°©ì§€ ë° ëª…í™•í•œ ëª¨ë“ˆ ê²½ê³„
- **í™•ì¥ì„±**: ìƒˆë¡œìš´ ë¶„ì„ ëª¨ë“ˆ ì¶”ê°€ ìš©ì´

#### ë°ì´í„° ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸
- **ë°ì´í„° ìˆ˜ì§‘**: Excel ì—…ë¡œë“œ â†’ íŒŒì‹± â†’ ì •ê·œí™” â†’ ì €ì¥
- **ì‹¤ì‹œê°„ ë¶„ì„**: ë°ì´í„°ë² ì´ìŠ¤ ë·°ë¥¼ í†µí•œ ì¦‰ì‹œ ë¶„ì„
- **AI ì—°ë™**: OpenAI APIë¥¼ í†µí•œ ì§€ëŠ¥í˜• ë¶„ì„

#### ì„±ëŠ¥ ìµœì í™”
- **ë·° ê¸°ë°˜ ë¶„ì„**: 30+ ë°ì´í„°ë² ì´ìŠ¤ ë·°ë¡œ ë³µì¡í•œ ì¿¼ë¦¬ ìµœì í™”
- **ìºì‹± ì „ëµ**: TypeORM ì—”í‹°í‹° ìºì‹± ë° ë·° ê¸°ë°˜ ë°ì´í„° ì œê³µ
- **ë¬´ì¤‘ë‹¨ ìš´ì˜**: PM2 í´ëŸ¬ìŠ¤í„° ëª¨ë“œë¡œ 24ì‹œê°„ ì•ˆì • ì„œë¹„ìŠ¤

## API ì—”ë“œí¬ì¸íŠ¸

### ğŸ­ ì½˜ì„œíŠ¸ ê´€ë ¨ API

#### ì¼ë°˜ ë°ì´í„° ì¡°íšŒ
- `GET /concert/daily` - ì½˜ì„œíŠ¸ ì¼ì¼ ë§¤ì¶œ ë°ì´í„°
- `GET /concert/monthly` - ì½˜ì„œíŠ¸ ì›”ê°„ ë§¤ì¶œ ë°ì´í„° (ì°¨íŠ¸ìš©)
- `GET /concert/weekly` - ì½˜ì„œíŠ¸ ì£¼ê°„ ë§¤ì¶œ ë°ì´í„° (ë§ˆì¼€íŒ… ì •ë³´ í¬í•¨)

#### ë¶„ì„ ë°ì´í„° ì¡°íšŒ
- `GET /concert/overview` - ì½˜ì„œíŠ¸ ì „ì²´ ê°œìš” (ì–´ì œ/ëˆ„ì /ì£¼ê°„ ë§¤ì¶œ)
- `GET /concert/bep` - ì½˜ì„œíŠ¸ BEP (ì†ìµë¶„ê¸°ì ) ë¶„ì„
- `GET /concert/estimated-profit` - ì½˜ì„œíŠ¸ ì˜ˆìƒ ìˆ˜ìµ
- `GET /concert/target-sales` - ì½˜ì„œíŠ¸ ëª©í‘œ ë§¤ì¶œ ëŒ€ë¹„ ì‹¤ì 
- `GET /concert/marketing-calendar` - ì½˜ì„œíŠ¸ ì£¼ê°„ ë§ˆì¼€íŒ… ìº˜ë¦°ë”

### ğŸª ì—°ê·¹/ë®¤ì§€ì»¬ ê´€ë ¨ API

#### ë°ì´í„° ì¡°íšŒ
- `GET /report/llm-play-daily` - ì—°ê·¹ ì¼ì¼ ë§¤ì¶œ ë°ì´í„°
- `GET /report/llm-play-weekly-a` - ì—°ê·¹ ì£¼ê°„ ë§¤ì¶œ ë°ì´í„° (A íƒ€ì…)
- `GET /report/llm-play-weekly-b` - ì—°ê·¹ ì£¼ê°„ ë§¤ì¶œ ë°ì´í„° (B íƒ€ì…)
- `GET /report/llm-play-weekly-c` - ì—°ê·¹ ì£¼ê°„ ë§¤ì¶œ ë°ì´í„° (C íƒ€ì…)
- `GET /report/llm-play-weekly-d` - ì—°ê·¹ ì£¼ê°„ ë§¤ì¶œ ë°ì´í„° (D íƒ€ì…)
- `GET /report/llm-play-est-profit` - ì—°ê·¹ ì˜ˆìƒ ìˆ˜ìµ
- `GET /report/llm-play-weekly-paidshare` - ì—°ê·¹ ì£¼ê°„ ìœ ë£Œ ì ìœ ìœ¨

### ğŸ‘¥ ì‚¬ìš©ì ê´€ë¦¬ API

- `GET /users/get-users` - ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
- `POST /users` - ì‚¬ìš©ì ìƒì„±
- `PATCH /users/:id` - ì‚¬ìš©ì ì •ë³´ ìˆ˜ì •
- `DELETE /users/:id` - ì‚¬ìš©ì ì‚­ì œ

### ğŸª ê³µì—° ê´€ë¦¬ API

- `GET /live` - ê³µì—° ëª©ë¡ ì¡°íšŒ
- `POST /live` - ê³µì—° ìƒì„±
- `PATCH /live/:id` - ê³µì—° ì •ë³´ ìˆ˜ì •
- `DELETE /live/:id` - ê³µì—° ì‚­ì œ

### ğŸ“ íŒŒì¼ ì—…ë¡œë“œ API

- `POST /upload` - íŒŒì¼ ì—…ë¡œë“œ
- `GET /upload` - ì—…ë¡œë“œ íŒŒì¼ ëª©ë¡ ì¡°íšŒ
- `DELETE /upload/:id` - ì—…ë¡œë“œ íŒŒì¼ ì‚­ì œ

### ğŸ¯ ëª©í‘œ ê´€ë¦¬ API

- `GET /target` - ëª©í‘œ ì„¤ì • ì¡°íšŒ
- `POST /target` - ëª©í‘œ ì„¤ì •
- `PATCH /target/:id` - ëª©í‘œ ìˆ˜ì •

### ğŸ“… ìº˜ë¦°ë” API

- `GET /calendar` - ìº˜ë¦°ë” ì¼ì • ì¡°íšŒ
- `POST /calendar` - ì¼ì • ìƒì„±
- `PATCH /calendar/:id` - ì¼ì • ìˆ˜ì •

### ğŸ“Š ë§ˆì¼€íŒ… API

- `GET /marketing` - ë§ˆì¼€íŒ… ìº˜ë¦°ë” ì¡°íšŒ
- `POST /marketing` - ë§ˆì¼€íŒ… ì¼ì • ìƒì„±
- `PATCH /marketing/:id` - ë§ˆì¼€íŒ… ì¼ì • ìˆ˜ì •

### ğŸ”” ì•Œë¦¼ API

- `POST /slack` - Slack ì•Œë¦¼ ì „ì†¡
- `GET /slack` - ì•Œë¦¼ ë‚´ì—­ ì¡°íšŒ

## ê°œë°œ í™˜ê²½ ì„¤ì •

### í•„ìˆ˜ ì†Œí”„íŠ¸ì›¨ì–´

#### ë¡œì»¬ ê°œë°œí™˜ê²½
- **Node.js**: v20.x ì´ìƒ (ìš´ì˜ì„œë²„: v20.18.3)
- **npm**: v10.x ì´ìƒ (ìš´ì˜ì„œë²„: v10.8.2)
- **Docker**: ìµœì‹  ë²„ì „ (ìš´ì˜ì„œë²„: v27.5.1)
- **Docker Compose**: v2.x ì´ìƒ (ìš´ì˜ì„œë²„: v2.32.4)

#### ê°œë°œ ë„êµ¬ (ì„ íƒì‚¬í•­)
- **PostgreSQL**: ë¡œì»¬ ì§ì ‘ ì„¤ì¹˜ì‹œ (Docker ì‚¬ìš© ê¶Œì¥)
- **DBeaver** ë˜ëŠ” **pgAdmin**: ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ë„êµ¬
- **Postman**: API í…ŒìŠ¤íŠ¸ ë„êµ¬

### í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `.env` íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•˜ì„¸ìš”:

#### ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • (ì‹¤ì œ ìš´ì˜ ê¸°ì¤€)
```bash
# PostgreSQL ì—°ê²° ì •ë³´
POSTGRES_HOST=127.0.0.1
POSTGRES_PORT=1377                    # âš ï¸ ì£¼ì˜: ê¸°ë³¸ 5432ê°€ ì•„ë‹˜!
POSTGRES_USER=libraryPostgres
POSTGRES_PASSWORD=your_password       # ë³´ì•ˆì„ ìœ„í•´ ë³€ê²½í•˜ì„¸ìš”
POSTGRES_DB=libraryPostgres
POSTGRES_CONTAINER=libraryPostgres
```

#### ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™
```bash
# OpenAI API (AI ê¸°ëŠ¥ìš©)
OPENAI_API_KEY=sk-proj-your-api-key

# Slack Webhook (ì•Œë¦¼ìš©)
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL

# í™˜ê²½ ì„¤ì •
MODE=DEV                              # ë¡œì»¬: DEV, ìš´ì˜: PROD
TZ=Asia/Seoul
NODE_ENV=development
```

### Docker Compose ë¡œì»¬ í™˜ê²½ êµ¬ì¶•

#### 1. PostgreSQL ì»¨í…Œì´ë„ˆ ì‹¤í–‰

âš ï¸ **ì¤‘ìš”**: ìš´ì˜ ì„œë²„ì™€ ë™ì¼í•œ í¬íŠ¸(1377) ì‚¬ìš©ì„ ìœ„í•´ `docker-compose.yaml` ìˆ˜ì •:

```yaml
version: '3.3'

services:
  postgres:
    image: postgres:15
    container_name: libraryPostgres
    restart: always
    volumes:
      - ./postgres-data:/var/lib/postgresql/data
    ports:
      - "1377:5432"                   # ìš´ì˜ê³¼ ë™ì¼í•œ í¬íŠ¸
    environment:
      POSTGRES_USER: libraryPostgres
      POSTGRES_PASSWORD: libraryPostgres777
      POSTGRES_DB: libraryPostgres
      TZ: Asia/Seoul
    networks:
      - app-network

networks:
  app-network:
    driver: bridge
```

#### 2. ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ë° í™•ì¸
```bash
# PostgreSQL ì»¨í…Œì´ë„ˆ ì‹œì‘
docker-compose up -d

# ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸ (ìš´ì˜ê³¼ ë™ì¼í•œ ì´ë¦„)
docker ps | grep libraryPostgres

# ì—°ê²° í…ŒìŠ¤íŠ¸ (ìš´ì˜ì„œë²„ì™€ ë™ì¼í•œ ë°©ì‹)
docker exec libraryPostgres pg_isready -U libraryPostgres

# ë¡œê·¸ í™•ì¸
docker-compose logs postgres
```

#### 3. ë°ì´í„°ë² ì´ìŠ¤ ë·° ìƒì„±
```bash
# ë·° ì •ì˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (ìš´ì˜ê³¼ ë™ì¼)
docker exec -i libraryPostgres psql -U libraryPostgres -d libraryPostgres < view-definitions.sql
```

### ë¡œì»¬ ê°œë°œ ì„œë²„ ì„¤ì •

#### uploads ë””ë ‰í† ë¦¬ ìƒì„±
```bash
# íŒŒì¼ ì—…ë¡œë“œë¥¼ ìœ„í•œ ë””ë ‰í† ë¦¬ ìƒì„± (ìš´ì˜ì„œë²„ì— ì¡´ì¬)
mkdir -p uploads
chmod 755 uploads
```

### ì„¤ì¹˜ ë° ì‹¤í–‰

#### 1. í”„ë¡œì íŠ¸ í´ë¡ 
```bash
git clone <repository-url>
cd library_company_data_analysis_server
```

#### 2. ì˜ì¡´ì„± ì„¤ì¹˜
```bash
# npm ì‚¬ìš©ì‹œ
npm install

# yarn ì‚¬ìš©ì‹œ
yarn install
```

#### 3. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```bash
# í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ ìƒì„±
cp .env.example .env

# .env íŒŒì¼ í¸ì§‘ (í™˜ê²½ì— ë§ê²Œ ìˆ˜ì •)
nano .env
```

#### 4. ë°ì´í„°ë² ì´ìŠ¤ ì‹¤í–‰
```bash
# Docker Composeë¡œ PostgreSQL ì‹¤í–‰
docker-compose up -d

# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸
docker-compose logs postgres
```

#### 5. NestJS ì„œë²„ ì‹¤í–‰
```bash
# ê°œë°œ ëª¨ë“œë¡œ ì„œë²„ ì‹¤í–‰ (íŒŒì¼ ë³€ê²½ ê°ì§€)
npm run start:dev

# ë˜ëŠ” ì¼ë°˜ ì‹¤í–‰
npm run start

# ë””ë²„ê·¸ ëª¨ë“œ (ì„ íƒì‚¬í•­)
npm run start:debug
```

#### 6. ì„œë²„ ì ‘ì† í™•ì¸
```bash
# API ì„œë²„ ì ‘ì† í™•ì¸
curl http://localhost:3001

# ë¸Œë¼ìš°ì €ì—ì„œ í™•ì¸
open http://localhost:3001
```

### í¬íŠ¸ ì„¤ì • ì£¼ì˜ì‚¬í•­

âš ï¸ **ì¤‘ìš”**: ì´ í”„ë¡œì íŠ¸ëŠ” **ë¹„í‘œì¤€ í¬íŠ¸**ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:
- **PostgreSQL**: 5432 â†’ **1377** ì‚¬ìš©
- **API ì„œë²„**: **3001** ì‚¬ìš©

ë¡œì»¬ ê°œë°œì‹œ ì´ í¬íŠ¸ë“¤ì´ ì¶©ëŒí•˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ì„¸ìš”!

## ë°°í¬ ê°€ì´ë“œ

### ì‹¤ì œ GCP ìš´ì˜ í™˜ê²½

#### 1. GCP ì¸ìŠ¤í„´ìŠ¤ í˜„í™© (ì‹¤ì œ ìš´ì˜ ì¤‘)
```bash
# ì¸ìŠ¤í„´ìŠ¤ ì •ë³´
- ì¸ìŠ¤í„´ìŠ¤ëª…: instance-20250211-224503
- ë¨¸ì‹  íƒ€ì…: e2-micro (1GB RAM, 1 vCPU)
- ìš´ì˜ì²´ì œ: Ubuntu 22.04.5 LTS  
- ë¦¬ì „: us-central1-a (ë¯¸êµ­ ì¤‘ë¶€)
- ë””ìŠ¤í¬: 29GB SSD (16GB ì‚¬ìš© ì¤‘, 53% ì‚¬ìš©ë¥ )
- ì™¸ë¶€IP: 35.208.29.100
```

#### 2. ì‹¤í–‰ ì¤‘ì¸ ì„œë¹„ìŠ¤ í˜„í™©
```bash
# 24ì¼ê°„ ë¬´ì¤‘ë‹¨ ìš´ì˜ ì¤‘ (ì•ˆì •ì„± ê²€ì¦ë¨)
- NestJS API: 3001 í¬íŠ¸ (PM2 í´ëŸ¬ìŠ¤í„° ëª¨ë“œ)
- PostgreSQL: 1377 í¬íŠ¸ (Docker ì»¨í…Œì´ë„ˆ)
- PM2 ë¡œê·¸ ë¡œí…Œì´ì…˜: í™œì„±í™”
- ì—…ë¡œë“œ íŒŒì¼: 85ê°œ+ ì—‘ì…€ íŒŒì¼ ê´€ë¦¬ ì¤‘
```

### ë°°í¬ ì ˆì°¨

#### 1. ë¡œì»¬ ê°œë°œ ë° í‘¸ì‹œ

```bash
# ë¡œì»¬ì—ì„œ ì½”ë“œ ìˆ˜ì • í›„
git add .
git commit -m "ì»¤ë°‹ ë©”ì‹œì§€"
git push
```

#### 2. ì„œë²„ ì ‘ì† ë° ë°°í¬

```bash
# 1. ì„œë²„ ì ‘ì†
ssh -i /Users/tikes-seukweeo/.ssh/library_company forifwhile.xyz@35.208.29.100

# 2. í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd library_company_data_analysis_server

# 3. ìµœì‹  ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
git pull

# 4. ê¸°ì¡´ ì„œë¹„ìŠ¤ ì¤‘ì§€ (ì¤‘ìš”: ë¹Œë“œ ì „ í•„ìˆ˜ ì‘ì—…)
docker-compose down
pm2 stop all

# 5. ë¹Œë“œ
npm run build

# 6. ì„œë¹„ìŠ¤ ì‹œì‘
docker-compose up -d
pm2 start all
```

### ì£¼ì˜ì‚¬í•­

- **4ë²ˆ ë‹¨ê³„ê°€ ì¤‘ìš”í•©ë‹ˆë‹¤**: `docker-compose down`ê³¼ `pm2 stop all`ì„ ë¹Œë“œ ì „ì— ì‹¤í–‰í•˜ì§€ ì•Šìœ¼ë©´ ë¹Œë“œ ê³¼ì •ì—ì„œ ì„œë²„ê°€ ë‹¤ìš´ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë‹¨ê³„ë¥¼ ìˆœì„œëŒ€ë¡œ ì§„í–‰í•´ì•¼ ì•ˆì „í•œ ë°°í¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### PM2 í”„ë¡œë•ì…˜ ì„¤ì • (í˜„ì¬ ìš´ì˜ ì¤‘)

#### ecosystem.config.js ì‹¤ì œ ì„¤ì •
```javascript
module.exports = {
  apps: [
    {
      name: 'app',
      script: './dist/main.js',
      instances: 1,
      exec_mode: 'cluster',
      watch: true,
      ignore_watch: ['node_modules', 'uploads', 'logs'],
      autorestart: true,
      max_restarts: 10,
      min_uptime: '60s',
      env: {
        NODE_ENV: 'development',  // âš ï¸ í˜„ì¬ ì„¤ì • (production ê¶Œì¥)
      },
      env_production: {
        NODE_ENV: 'production',
      },
    },
  ],
};
```

#### PM2 ìš´ì˜ ëª…ë ¹ì–´
```bash
# í˜„ì¬ ìƒíƒœ í™•ì¸
pm2 list                              # ì‹¤í–‰ ì¤‘ì¸ ì•± ëª©ë¡
pm2 show app                          # ìƒì„¸ ì •ë³´ (24ì¼ ì—…íƒ€ì„)
pm2 logs app --lines 100              # ë¡œê·¸ í™•ì¸

# ì„œë¹„ìŠ¤ ê´€ë¦¬
pm2 restart app                       # ì•± ì¬ì‹œì‘
pm2 stop app                          # ì•± ì¤‘ì§€
pm2 start ecosystem.config.js --env production

# ë¡œê·¸ ê´€ë¦¬ (ë¡œê·¸ ë¡œí…Œì´ì…˜ í™œì„±í™”ë¨)
pm2 logs                              # ì‹¤ì‹œê°„ ë¡œê·¸
pm2 flush                             # ë¡œê·¸ ì´ˆê¸°í™”
```

### ë°ì´í„°ë² ì´ìŠ¤ ìš´ì˜ (ì‹¤ì œ êµ¬ì„±)

#### PostgreSQL ì‹¤ì œ ì„¤ì •
```bash
# í˜„ì¬ ìš´ì˜ ì¤‘ì¸ ì„¤ì •
- ì»¨í…Œì´ë„ˆëª…: libraryPostgres
- ì´ë¯¸ì§€: postgres:15
- í¬íŠ¸: 1377 (ì™¸ë¶€) â†’ 5432 (ì»¨í…Œì´ë„ˆ ë‚´ë¶€)
- ì‚¬ìš©ì: libraryPostgres
- ë°ì´í„°ë² ì´ìŠ¤: libraryPostgres
- ë°ì´í„° ë³¼ë¥¨: ./postgres-data (ì˜ì†ì„± ë³´ì¥)
```

#### ë°±ì—… ë° ë³µêµ¬ (í˜„ì¬ ìš´ì˜ ì¤‘)
```bash
# ì •ê¸° ë°±ì—… (ì‹¤ì œ ë°±ì—… íŒŒì¼ ì¡´ì¬: backup_20250615_024839.sql)
DATE=$(date +%Y%m%d_%H%M%S)
docker exec libraryPostgres pg_dump -U libraryPostgres libraryPostgres > backup_$DATE.sql

# ë°±ì—… ë³µêµ¬
docker exec -i libraryPostgres psql -U libraryPostgres -d libraryPostgres < backup_file.sql

# ë·° ì •ì˜ ì—…ë°ì´íŠ¸ (ìš´ì˜ ì¤‘ ê²€ì¦ë¨)
docker exec -i libraryPostgres psql -U libraryPostgres -d libraryPostgres < view-definitions.sql
```

## ì‚¬ìš© ê°€ì´ë“œ

### ì½˜ì„œíŠ¸ ëŒ€ì‹œë³´ë“œ API ì‚¬ìš© ê°€ì´ë“œ

#### 1. ì¢Œì„ë³„ ìˆ˜ì… í˜„í™© í…Œì´ë¸”
```javascript
// API í˜¸ì¶œ
const bepData = await fetch(`${API_BASE_URL}/concert/bep`)
  .then(res => res.json())
  .then(data => data.filter(item => item.liveId === selectedLiveId));

// ë°ì´í„° ë§¤í•‘
const tableData = bepData.map(item => ({
  ì¢Œì„ë“±ê¸‰: item.seatClass,
  ì „ì„: item.totalSeats,
  íŒë§¤: item.soldSeats,
  ì´ˆëŒ€: item.totalSeats - item.soldSeats - item.remainingSeats,
  ì”ì—¬: item.remainingSeats,
  ì¶”ê°€íŒë§¤ì˜ˆìƒ: parseInt(item.estAdditionalSales),
  ìµœì¢…ì”ì—¬ì˜ˆìƒ: parseInt(item.estFinalRemaining),
  'BEP %': (item.bepRatio * 100).toFixed(1) + '%'
}));
```

#### 2. ì¼ê°„ ë§¤ì¶œ ì°¨íŠ¸
```javascript
// API í˜¸ì¶œ
const dailyData = await fetch(`${API_BASE_URL}/concert/daily`)
  .then(res => res.json())
  .then(data => data.filter(item => item.liveId === selectedLiveId));

// ì°¨íŠ¸ ë°ì´í„°
const chartData = {
  labels: dailyData.map(item => item.recordDate),
  datasets: [{
    label: 'ì¼ê°„ ë§¤ì¶œ',
    data: dailyData.map(item => item.dailySalesAmount),
    backgroundColor: '#4CAF50'
  }]
};
```

#### 3. ì£¼ê°„ ë§¤ì¶œ í‘œ
```javascript
// API í˜¸ì¶œ
const weeklyData = await fetch(`${API_BASE_URL}/concert/weekly`)
  .then(res => res.json())
  .then(data => data.filter(item => item.liveId === selectedLiveId));

// í…Œì´ë¸” ë°ì´í„°
const weeklyTableData = weeklyData.map(item => ({
  'ì£¼ ì‹œì‘ì¼': item.recordWeek,
  'ì„¸ì¼ì¦ˆ': item.noteSalesMarketing,
  'í”„ë¡œëª¨ì…˜': item.notePromotion,
  'ê¸°íƒ€': item.noteEtc,
  'ë§¤ì¶œ': item.weeklySalesAmount.toLocaleString() + 'ì›',
  'íŒë§¤ ë§¤ìˆ˜': item.weeklySalesTicketNo + 'ë§¤'
}));
```

### BEP ë¶„ì„ í™œìš©

#### BEP ë¶„ì„ ë°ì´í„°
```javascript
// /concert/bep ì‘ë‹µ ë°ì´í„° ë¶„ì„
const bepAnalysis = {
  í˜„ì¬íŒë§¤ìœ¨: (soldSeats / totalSeats * 100).toFixed(1) + '%',
  BEPë‹¬ì„±ë¥ : (bepRatio * 100).toFixed(1) + '%',
  ì˜ˆìƒíŒë§¤ìœ¨: (estSalesRatio * 100).toFixed(1) + '%',
  ìˆ˜ìµì„±ìƒíƒœ: bepRatio >= 1.0 ? 'ëª©í‘œ ë‹¬ì„±' : 'ëª©í‘œ ë¯¸ë‹¬',
  ì¶”ê°€íŒë§¤í•„ìš”: Math.max(0, parseFloat(bepSeats) - soldSeats) + 'ì„'
};
```

### ì—ëŸ¬ í•¸ë“¤ë§
```javascript
// API í˜¸ì¶œ ì‹œ ì—ëŸ¬ ì²˜ë¦¬
const fetchConcertData = async (endpoint) => {
  try {
    const response = await fetch(`${API_BASE_URL}${endpoint}`);
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    return await response.json();
  } catch (error) {
    console.error('API í˜¸ì¶œ ì‹¤íŒ¨:', error);
    return [];
  }
};
```

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œ ë° í•´ê²°ë²•

#### 1. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨
```bash
# PostgreSQL ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
docker-compose down && docker-compose up -d

# í™˜ê²½ë³€ìˆ˜ í™•ì¸
cat .env | grep POSTGRES

# í¬íŠ¸ ì¶©ëŒ í™•ì¸
lsof -i :1377
```

#### 2. í¬íŠ¸ ì¶©ëŒ (3001 í¬íŠ¸ ì‚¬ìš© ì¤‘)
```bash
# í¬íŠ¸ ì‚¬ìš© í”„ë¡œì„¸ìŠ¤ í™•ì¸
lsof -i :3001

# í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
kill -9 <PID>
```

#### 3. ë©”ëª¨ë¦¬ ë¶€ì¡± (e2-micro ì œí•œ)
```bash
# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸
free -h                               # 958Mi ì´ ë©”ëª¨ë¦¬
pm2 monit                            # í™ ì‚¬ìš©ëŸ‰ 85%+ ì£¼ì˜

# í•´ê²°ë°©ë²•
pm2 restart app                      # ë©”ëª¨ë¦¬ í•´ì œ
```

### ìœ ìš©í•œ ê°œë°œ ëª…ë ¹ì–´

```bash
# ì½”ë“œ í¬ë§¤íŒ…
npm run format

# ë¦°íŠ¸ ê²€ì‚¬
npm run lint

# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npm run test

# E2E í…ŒìŠ¤íŠ¸
npm run test:e2e

# í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€
npm run test:cov
```

## ìµœì‹  ì—…ë°ì´íŠ¸ ë‚´ì—­

### 2025.07.10 - Concert Dashboard API ì™„ë£Œ
- ì½˜ì„œíŠ¸ ëŒ€ì‹œë³´ë“œ API ì „ì²´ êµ¬í˜„ ì™„ë£Œ
- ì£¼ê°„ ë§¤ì¶œ API (`/concert/weekly`) ì¶”ê°€
- BEP ë¶„ì„ ë° ì˜ˆìƒ ìˆ˜ìµ API êµ¬í˜„
- ë§ˆì¼€íŒ… ìº˜ë¦°ë” ì—°ë™ ê¸°ëŠ¥ ì¶”ê°€
- í”„ë¡œë•ì…˜ ì„œë²„ ì•ˆì • ìš´ì˜ (24ì¼ ë¬´ì¤‘ë‹¨)

### 2025.07.09 - ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë¬¸ì„œí™”
- ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ ì‘ì„±
- ì¸í”„ë¼ êµ¬ì¡°ë„ ìƒì„¸ ë¬¸ì„œí™”
- ë°ì´í„°ë² ì´ìŠ¤ ERD ì—…ë°ì´íŠ¸
- API ì—”ë“œí¬ì¸íŠ¸ í†µí•© ì •ë¦¬

---

**ğŸ“ ì§€ì› ë° ë¬¸ì˜**
- ê°œë°œì: jwlee-ticket
- ì´ë©”ì¼: jwlee0305@ticketsquare.co.kr
- ì„œë²„ IP: 35.208.29.100:3001